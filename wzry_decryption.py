from decrypt_AES import *
import zlib
import lz4.block as lb


def udp_decrypt():
    data = '3366000b000b4013010000000600000019000002d002106d00088028c1e2e974915b737f8b96738785e92aef3525d56a2aefb378d191590b4e6fff821b5c65c74368c107dcc851af779872b8b11c4006f38a0a34734a3bd397b09e8c22a367af8afc731e14840df28e29d730a2c58c010703f35270788b533800c19ff9d0d238631ad5775baefcd409198b699516f5a23b88d9f42238b9db76efb61ee0acb231443f70e871d386e547a667975972fbb12d7119c134e0f614cf66dc0805559d83b8b610d80f5c9038d29537e3b310f9e81d786be7b82a0d31bc1a784f7d659adb27e080e59fa43a41fd02bc7dc88604bf9f2272ed2bad35cd76fffcc46356c80f8f5878890d1023d0631b0ac426e1fb6a6d97edcbe80bd9ff927f0ec60e5936328d17cc16ef2c4f60bde577976972e30e844c32f0db8af1789e33324394c4cba32ae4d22a4d6a667da12ebdb2ade66f0405cf57501d764330020545500f9db6b07b8289ac870d0ed25d2a8fbbd5e384e8b59ea8c8584989b23592ad7a4fabf7be99907d4f99807be968240ed3d12460c3d6a0d80d4cc47d95e93b91c8c9a6618b2a36d3408e19374ac2183c705a0f1271e746ff4f64ffe0bcc23cc8d9c19cb80629860e59221ada61359d60d911cce0fb8fff79fd175a60f00178c61c0b6277602c15daaa50cbd9c904fa9849bab2ba840e08427e0526fb4c10ac289ac9e06fe4620f84c20a82e520d22b5a37406421b78760f780d41261cc175cc149a2327df8ad4358fc1013b1f167e206f1c3d40a9633dc2f518ad5c356e011d07105dc627f817612ebc82fbafa3b5050cc0050cb08f8625357eb392cddb515c303103425893ec5ef644e92e47e186ad3555ee0639c5ce4d23fcf206dc1eca05496bb809f1c7e822603aab642f32c3f7b69a879ce850d2cda6ebd504ed2957bdfff2ea955dc979ee07700fcca153d05ced568e6049a5d20523c5e906926c07f0f561a448afac6790b247c522ef00f992c5448a18a4a7ae36b3f5c22eb64f17a726a05f087893bafb04fae51c07787'
    key_data = '33366000b000b10020100000001000000300000001002106d474135534b36735963524654705741020000002800000000153a233440f63e0004bbe23cd015cada0ae4f55a'
    iv_data = '000102030405060708090a0b0c0d0e0f'
    data = bytes.fromhex(data)
    key_data = bytes.fromhex(key_data)
    # print(data)
    # print(key_data)
    dec_data_len = int.from_bytes(data[17:21], 'big')
    print("udp data len:", dec_data_len)
    raw_data = data[25:25 + dec_data_len]
    print(raw_data.hex())
    dec_key = key_data[23:39]
    dec_iv = bytes.fromhex(iv_data)
    dec_data = AES_CBC_decrypt(raw_data, dec_key, dec_iv)
    print("AES decrypt udp_data: ", dec_data)
    compress_data = bytes.fromhex(dec_data.decode(encoding='utf-8'))
    decompress_data = zlib.decompress(compress_data, +15)
    print("zlib decompress udp_data: ", decompress_data.hex())


def tcp_decrypt():
    data = '3366000b000b4013010000006e0000001900000480011064005d8209cd1e75a0a058ef0df0d45c9428ec9ee76db04ef1be28e4b95b8ad5a4e602ce5fea6a41aea9b433c5296cf35222596c5dfe888c5255b85bb44cdf9df0f01f6b1c0534703a856941a3918846efb5c1c869e7d1b262954d5639dee2b0c423f488490445010612f2fe605415fdb6e414ea171652eb60e03607ad877ee1ecb4f22e125a85b91bd7500df50d10b40bbdf96024403ca36b2ac5c0fa495a50e472f9ed32bcb5f13d533752ee3394a22bf8659eb5eb96819bd430815fb9ed9295c6829dc498123a3bd68e4b3ff06171f43f1bc7b6aac1329016b5261638e73ea8d5509797ff6fc2d96de8108e8f72bb68529856024df1710b29d97cd2cbb37fa2af62b48372a617c203ba7b96f2b0bcc80598cad174e1db89c5eab522eeac58b18009e06b6c724f7dd446f930e743be77afd36283ac1209359180fe12a511032ddd28c13e6844099a1bbdde59995b462633d17b81db4162ff7318eb3880650b3690a3dafdeba4761d1ee1d1efc18b0730d0281931194f5a6560eaf1b5bbaa4710c618687355319fe6c7041f2daaabfb0dea6ee2581ce6cfa6b7dd74cba61433903dfb3778a21996ed188df61d73ebbd5b2f2c45fddefb7d3d0682d8d96f6ea24ba83fdbee9f34001fb78b940014338b529a78a071692871af2e67f574e48caf65830f951f46193d044c09bf2665ed07895cd7f3dd56f9f931cbbdc1f5ec686a693991bbdc6c04f49f4ebbd3446da39b342938aa33842a98f8f702246d4c1c5cab88f3406bf29529cb67f8421735045b40a948b4af2b5eab041e3d1a6d38cd23376feab218903f4fc9f3d4603dae1ef7775a044190e14cf629c2236a5acaf64eb95346ccfb2155d8d25f10e64a111309fa77ca0df27e57140e7c8bbfb1c590c4a75fc1b633289623d099c2b0a7cf17588f7bf9ffc9f3cb00640638453d2130c39d6b2d029beee24c10efc509595967cc1905cb45a20466ee0ce98ff27cfced458b1e34a54ecd8a4be99789e908bcb310c77e6340142ca12bde928517dba5abdd30a19f552ea091eb6d0501e5a9bb900d3342d6aef8545f50bf25e473569b48ccfc18422f68afe41341fa4752c0b389e2bd2ff4f7454d45b206c4029dde984c12aaa891b78b2ccca8945d29637457bccf1fa5deeb427f7696fb62688170fca39880a6ffb2d99e72edbb993ac021f72add829d6c0011ab0717e5d3fab18718231da1a5fee872cd588d065745a88b901fdc52aa1204e51cb2c255d05bf2c2860d41992557e5b816b0830a1507169ffa93832d5f1c08f4b1b7cd0ab0f6f6b24a5698d5482567db8bc81869b9aab2bc566ddcedd0ee083cce850ed87eec856fcbccf0b3580de6f56531763a65b7104d90e9788cfff50480d15a6a2d7e99b6f8e7b835203302a0f1e266bff2c09c23397a41d099ed865b30ea20244068de365bea46624c59c530e5f69a7f11c5159fa8b70c4c187e68f6313334eb29537fc8e894f07c4c2434519c53e11ac5477427ddef82d8a6e0eb341e945707e699b825ed0d4d31ec2fa93e762a2577c3e759e8eaebd0a357b3ad5ec74648ed0c3a33fbda8e01040ef02ad15aa9893057c339344e3e5cfe4df4b42103cedb8a8b743c3cd96b687d3c80'
    key_data = '3366000b000b1002010000000100000030000000100210645456717a6d6b5064674d434553626d0100000064000000002fd4d2fcde5ad219618e7b44fdc36a73'
    iv_data = '000102030405060708090a0b0c0d0e0f'
    data = bytes.fromhex(data)
    key_data = bytes.fromhex(key_data)
    # print(data)
    # print(key_data)
    dec_data_len = int.from_bytes(data[17:21], 'big')
    print("tcp data len:", dec_data_len)
    raw_data = data[25:25 + dec_data_len]
    dec_key = key_data[23:39]
    dec_iv = bytes.fromhex(iv_data)
    dec_data = AES_CBC_decrypt(raw_data, dec_key, dec_iv)
    print("AES decrypt tcp_data: ", dec_data)
    compress_data = bytes.fromhex(dec_data.decode(encoding='utf-8'))
    for i in range(dec_data_len):
        try:
            de_data = lb.decompress(compress_data[:dec_data_len - i], uncompressed_size=102400)
            if de_data:
                print("lz4 decompress tcp_data: ", de_data.hex())
                break
        except Exception as e:
            pass
        continue


if __name__ == '__main__':
    tcp_decrypt()
    udp_decrypt()
